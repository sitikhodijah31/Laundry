<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreshClean Laundry</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
            .container { 
                max-width: 1200px; 
                margin: 0 auto; 
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                overflow: hidden;
            }
            .header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            .header h1 { font-size: 2em; margin-bottom: 5px; }
            .header p { opacity: 0.9; }
            .hidden { display: none; }
            .login-section {
                padding: 60px 40px;
                max-width: 500px;
                margin: 0 auto;
            }
            .login-section h2 {
                color: #667eea;
                margin-bottom: 30px;
                text-align: center;
            }
            .role-selector {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin-bottom: 30px;
            }
            .role-btn {
                padding: 20px;
                border: 3px solid #e0e0e0;
                border-radius: 10px;
                background: white;
                cursor: pointer;
                transition: all 0.3s;
                text-align: center;
            }
            .role-btn:hover {
                border-color: #667eea;
                background: #f8f9ff;
            }
            .role-btn.active {
                border-color: #667eea;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
            .role-btn h3 {
                font-size: 18px;
                margin-bottom: 5px;
            }
            .role-btn p {
                font-size: 13px;
                opacity: 0.8;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-group label {
                display: block;
                margin-bottom: 8px;
                color: #333;
                font-weight: 500;
            }
            input[type="text"], input[type="password"], input[type="number"], input[type="tel"], input[type="email"], select, textarea {
                width: 100%;
                padding: 12px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                font-size: 14px;
                transition: border 0.3s;
                font-family: inherit;
            }
            textarea {
                resize: vertical;
                min-height: 80px;
            }
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: #667eea;
            }
            button {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: transform 0.2s, box-shadow 0.2s;
                margin: 5px;
            }
            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }
            button.secondary {
                background: #6c757d;
            }
            button.danger {
                background: #dc3545;
            }
            button.success {
                background: #28a745;
            }
            .dashboard {
                padding: 30px;
            }
            .menu-buttons {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }
            .menu-buttons button {
                width: 100%;
                padding: 20px;
                font-size: 16px;
            }
            .section {
                padding: 30px;
            }
            .section h2 {
                color: #667eea;
                margin-bottom: 25px;
                padding-bottom: 10px;
                border-bottom: 3px solid #667eea;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
                background: white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                border-radius: 8px;
                overflow: hidden;
            }
            th {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px;
                text-align: left;
                font-weight: 600;
            }
            td {
                padding: 12px 15px;
                border-bottom: 1px solid #e0e0e0;
            }
            tr:hover {
                background: #f8f9ff;
            }
            .form-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }
            .alert {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            .alert-error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .alert-success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            .stat-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }
            .stat-card h3 {
                font-size: 14px;
                opacity: 0.9;
                margin-bottom: 10px;
            }
            .stat-card p {
                font-size: 28px;
                font-weight: bold;
            }
            .badge {
                display: inline-block;
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }
            .badge-pending { background: #ffc107; color: #000; }
            .badge-process { background: #17a2b8; color: white; }
            .badge-done { background: #28a745; color: white; }
            .badge-taken { background: #6c757d; color: white; }
            .user-info {
                background: #f8f9ff;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 30px;
            }
            .user-info h3 {
                color: #667eea;
                margin-bottom: 10px;
            }
            .order-card {
                background: white;
                border: 2px solid #e0e0e0;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 15px;
                transition: all 0.3s;
            }
            .order-card:hover {
                border-color: #667eea;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            }
            .order-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid #e0e0e0;
            }
            .order-details {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            .order-detail-item {
                font-size: 14px;
            }
            .order-detail-item strong {
                display: block;
                color: #667eea;
                margin-bottom: 5px;
            }
            .link-text {
                color: #667eea;
                cursor: pointer;
                text-decoration: underline;
            }
            .link-text:hover {
                color: #764ba2;
            }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üß∫ FreshClean Laundry</h1>
        <p>Bersihnya Terasa, Harganya Bersahabat</p>
    </div>

    <!-- Login Section -->
    <div id="login" class="login-section">
        <h2>Login Sistem</h2>
        
        <div class="role-selector">
            <div class="role-btn active" onclick="selectRole('admin')">
                <h3>üë®‚Äçüíº Admin</h3>
                <p>Kelola sistem laundry</p>
            </div>
            <div class="role-btn" onclick="selectRole('pelanggan')">
                <h3>üë§ Pelanggan</h3>
                <p>Pantau pesanan Anda</p>
            </div>
        </div>

        <div id="adminLogin">
            <div class="form-group">
                <label>Username Admin</label>
                <input type="text" id="adminUsername" placeholder="admin">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="adminPassword" placeholder="admin">
            </div>
            <button onclick="loginAdmin()" style="width: 100%;">Login sebagai Admin</button>
        </div>

        <div id="pelangganLogin" class="hidden">
            <div class="form-group">
                <label>No. Telepon</label>
                <input type="tel" id="pelangganTelp" placeholder="08xxxxxxxxxx">
            </div>
            <button onclick="loginPelanggan()" style="width: 100%;">Login sebagai Pelanggan</button>
            <p style="text-align: center; margin-top: 15px;">
                Belum punya akun? <span class="link-text" onclick="showRegister()">Daftar di sini</span>
            </p>
        </div>

        <div id="registerForm" class="hidden">
            <h3 style="color: #667eea; margin-bottom: 20px;">Daftar Akun Pelanggan</h3>
            <div class="form-group">
                <label>Nama Lengkap</label>
                <input type="text" id="regNama" placeholder="Nama lengkap">
            </div>
            <div class="form-group">
                <label>No. Telepon</label>
                <input type="tel" id="regTelp" placeholder="08xxxxxxxxxx">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="email@example.com">
            </div>
            <div class="form-group">
                <label>Alamat</label>
                <textarea id="regAlamat" placeholder="Alamat lengkap"></textarea>
            </div>
            <button onclick="registerPelanggan()" style="width: 100%;">Daftar</button>
            <p style="text-align: center; margin-top: 15px;">
                Sudah punya akun? <span class="link-text" onclick="showLogin()">Login di sini</span>
            </p>
        </div>

        <p id="loginMsg" style="margin-top: 15px; text-align: center; color: #dc3545;"></p>
    </div>

    <!-- ============== ADMIN DASHBOARD ============== -->
    <div id="adminDashboard" class="dashboard hidden">
        <h2>Dashboard Admin</h2>
        <div class="stats">
            <div class="stat-card">
                <h3>Total Transaksi</h3>
                <p id="totalTransaksi">0</p>
            </div>
            <div class="stat-card">
                <h3>Pending</h3>
                <p id="totalPending">0</p>
            </div>
            <div class="stat-card">
                <h3>Pendapatan Hari Ini</h3>
                <p id="pendapatanHariIni">Rp 0</p>
            </div>
            <div class="stat-card">
                <h3>Total Pelanggan</h3>
                <p id="totalPelanggan">0</p>
            </div>
        </div>
        <div class="menu-buttons">
            <button onclick="showSection('pelanggan')">üë§ Data Pelanggan</button>
            <button onclick="showSection('layanan')">üßº Layanan Laundry</button>
            <button onclick="showSection('transaksi')">üí∞ Transaksi Baru</button>
            <button onclick="showSection('laporan')">üìä Laporan</button>
            <button onclick="logout()" class="secondary">üö™ Logout</button>
        </div>
    </div>

    <!-- Data Pelanggan (Admin) -->
    <div id="pelanggan" class="section hidden">
        <h2>Data Pelanggan</h2>
        <button onclick="showSection('adminDashboard')">‚Üê Kembali</button>
        
        <table id="tabelPelanggan" style="margin-top: 20px;">
            <tr><th>ID</th><th>Nama</th><th>Telepon</th><th>Email</th><th>Alamat</th><th>Aksi</th></tr>
        </table>
    </div>

    <!-- Layanan Laundry (Admin) -->
    <div id="layanan" class="section hidden">
        <h2>Layanan Laundry</h2>
        <button onclick="showSection('adminDashboard')">‚Üê Kembali</button>
        
        <div class="form-row" style="margin-top: 25px;">
            <div class="form-group">
                <label>Nama Layanan</label>
                <input type="text" id="namaLayanan" placeholder="Contoh: Cuci Kering">
            </div>
            <div class="form-group">
                <label>Harga per Kg</label>
                <input type="number" id="hargaLayanan" placeholder="5000">
            </div>
            <div class="form-group">
                <label>Estimasi (Hari)</label>
                <input type="number" id="estimasiLayanan" placeholder="3">
            </div>
        </div>
        <button onclick="simpanLayanan()" id="btnSimpanLayanan">Tambah Layanan</button>
        <button onclick="batalEditLayanan()" id="btnBatalLayanan" class="secondary hidden">Batal Edit</button>

        <table id="tabelLayanan">
            <tr><th>Nama Layanan</th><th>Harga/Kg</th><th>Estimasi</th><th>Aksi</th></tr>
        </table>
    </div>

    <!-- Transaksi Baru (Admin) -->
    <div id="transaksi" class="section hidden">
        <h2>Transaksi Baru</h2>
        <button onclick="showSection('adminDashboard')">‚Üê Kembali</button>
        
        <div class="form-row" style="margin-top: 25px;">
            <div class="form-group">
                <label>Nama Pelanggan</label>
                <input type="text" id="namaPelangganTransaksi" placeholder="Masukkan nama pelanggan">
            </div>
            <div class="form-group">
                <label>No. Telepon Pelanggan</label>
                <input type="tel" id="telpPelangganTransaksi" placeholder="08xxxxxxxxxx">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Jenis Layanan</label>
                <select id="pilihLayanan">
                    <option value="">-- Pilih Layanan --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Berat (Kg)</label>
                <input type="number" id="beratLaundry" placeholder="5" step="0.5">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Metode Pembayaran</label>
                <select id="metodePembayaran">
                    <option value="Tunai">üíµ Tunai</option>
                    <option value="Transfer BCA">üè¶ Transfer BCA</option>
                    <option value="Transfer Mandiri">üè¶ Transfer Mandiri</option>
                    <option value="QRIS">üì± QRIS</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>Catatan (Opsional)</label>
            <textarea id="catatanTransaksi" placeholder="Catatan khusus untuk pesanan ini"></textarea>
        </div>
        <button onclick="hitungTotal()">Hitung Total</button>
        <div style="margin: 20px 0; padding: 20px; background: #f8f9ff; border-radius: 8px;">
            <h3 style="color: #667eea;">Total Pembayaran</h3>
            <p id="totalBayar" style="font-size: 32px; font-weight: bold; color: #333;">Rp 0</p>
        </div>
        <button onclick="simpanTransaksi()">üíæ Simpan Transaksi</button>
    </div>

    <!-- Laporan (Admin) -->
    <div id="laporan" class="section hidden">
        <h2>Laporan Transaksi</h2>
        <button onclick="showSection('adminDashboard')">‚Üê Kembali</button>
        
        <div style="margin: 20px 0;">
            <button onclick="filterStatus('semua')">Semua</button>
            <button onclick="filterStatus('pending')" class="secondary">Pending</button>
            <button onclick="filterStatus('proses')" class="secondary">Proses</button>
            <button onclick="filterStatus('selesai')" class="secondary">Selesai</button>
            <button onclick="filterStatus('diambil')" class="secondary">Diambil</button>
        </div>

        <table id="tabelLaporan">
            <tr>
                <th>No. Order</th>
                <th>Tanggal</th>
                <th>Pelanggan</th>
                <th>Layanan</th>
                <th>Berat</th>
                <th>Total</th>
                <th>Status</th>
                <th>Aksi</th>
            </tr>
        </table>
    </div>

    <!-- ============== PELANGGAN DASHBOARD ============== -->
    <div id="pelangganDashboard" class="dashboard hidden">
        <div class="user-info">
            <h3>üë§ Informasi Akun</h3>
            <p><strong>Nama:</strong> <span id="userNama"></span></p>
            <p><strong>Telepon:</strong> <span id="userTelp"></span></p>
            <p><strong>Email:</strong> <span id="userEmail"></span></p>
            <p><strong>Alamat:</strong> <span id="userAlamat"></span></p>
        </div>

        <div class="menu-buttons">
            <button onclick="showSection('pesananSaya')">üì¶ Pesanan Saya</button>
            <button onclick="showSection('buatPesanan')">‚ûï Buat Pesanan Baru</button>
            <button onclick="showSection('riwayat')">üìú Riwayat Pesanan</button>
            <button onclick="logout()" class="secondary">üö™ Logout</button>
        </div>
    </div>

    <!-- Pesanan Saya (Pelanggan) -->
    <div id="pesananSaya" class="section hidden">
        <h2>Pesanan Saya</h2>
        <button onclick="showSection('pelangganDashboard')">‚Üê Kembali</button>
        
        <div id="listPesananAktif" style="margin-top: 25px;">
            <!-- Pesanan akan dimuat di sini -->
        </div>
    </div>

    <!-- Buat Pesanan Baru (Pelanggan) -->
    <div id="buatPesanan" class="section hidden">
        <h2>Buat Pesanan Baru</h2>
        <button onclick="showSection('pelangganDashboard')">‚Üê Kembali</button>
        
        <div class="form-row" style="margin-top: 25px;">
            <div class="form-group">
                <label>Pilih Layanan</label>
                <select id="pelangganPilihLayanan">
                    <option value="">-- Pilih Layanan --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Estimasi Berat (Kg)</label>
                <input type="number" id="pelangganBerat" placeholder="5" step="0.5">
            </div>
        </div>
        <div class="form-group">
            <label>Catatan (Opsional)</label>
            <textarea id="pelangganCatatan" placeholder="Catatan khusus untuk pesanan Anda"></textarea>
        </div>
        <button onclick="hitungTotalPelanggan()">Hitung Estimasi Biaya</button>
        
        <div style="margin: 20px 0; padding: 20px; background: #f8f9ff; border-radius: 8px;">
            <h3 style="color: #667eea;">Estimasi Pembayaran</h3>
            <p id="totalBayarPelanggan" style="font-size: 32px; font-weight: bold; color: #333;">Rp 0</p>
            <p style="margin-top: 10px; font-size: 13px; color: #666;">*Biaya final akan disesuaikan dengan berat aktual saat laundry diterima</p>
        </div>

        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border: 2px solid #ffc107; margin: 20px 0;">
            <h3 style="color: #856404; margin-bottom: 15px;">üí≥ Informasi Pembayaran via Transfer</h3>
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="font-weight: bold; color: #667eea; margin-bottom: 10px;">Bank BCA</p>
                <p style="font-size: 20px; font-weight: bold; color: #333;">1234567890</p>
                <p style="color: #666;">A.N FreshClean Laundry</p>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="font-weight: bold; color: #667eea; margin-bottom: 10px;">Bank Mandiri</p>
                <p style="font-size: 20px; font-weight: bold; color: #333;">9876543210</p>
                <p style="color: #666;">A.N FreshClean Laundry</p>
            </div>
            <p style="font-size: 13px; color: #856404; margin-top: 10px;">
                ‚ö†Ô∏è Transfer sesuai nominal yang tertera. Upload bukti transfer setelah pembayaran.
            </p>
        </div>

        <div class="form-group">
            <label>Upload Bukti Transfer</label>
            <input type="file" id="buktiTransfer" accept="image/*" style="padding: 10px;">
            <p style="font-size: 12px; color: #666; margin-top: 5px;">Format: JPG, PNG (Max 5MB)</p>
        </div>

        <button onclick="buatPesananBaru()" class="success">üì§ Kirim Pesanan</button>
    </div>

    <!-- Riwayat Pesanan (Pelanggan) -->
    <div id="riwayat" class="section hidden">
        <h2>Riwayat Pesanan</h2>
        <button onclick="showSection('pelangganDashboard')">‚Üê Kembali</button>
        
        <div id="listRiwayat" style="margin-top: 25px;">
            <!-- Riwayat akan dimuat di sini -->
        </div>
    </div>
</div>

<script>
let pelanggan = [];
let layanan = [];
let transaksi = [];
let currentFilter = 'semua';
let currentUser = null;
let currentRole = 'admin';
let editingLayananIndex = -1;

// Initialize dengan data default
function initData() {
    // Tambah admin default
    if (!pelanggan.find(p => p.telp === 'admin')) {
        // Admin dummy
    }
    
    // Tambah layanan default
    if (layanan.length === 0) {
        layanan = [
            { nama: 'Cuci Kering', harga: 5000, estimasi: 2 },
            { nama: 'Cuci Setrika', harga: 7000, estimasi: 3 },
            { nama: 'Setrika Saja', harga: 4000, estimasi: 1 },
            { nama: 'Cuci Express', harga: 10000, estimasi: 1 }
        ];
    }
}

// Role Selection
function selectRole(role) {
    currentRole = role;
    document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
    event.target.closest('.role-btn').classList.add('active');
    
    if (role === 'admin') {
        document.getElementById('adminLogin').classList.remove('hidden');
        document.getElementById('pelangganLogin').classList.add('hidden');
        document.getElementById('registerForm').classList.add('hidden');
    } else {
        document.getElementById('adminLogin').classList.add('hidden');
        document.getElementById('pelangganLogin').classList.remove('hidden');
        document.getElementById('registerForm').classList.add('hidden');
    }
    document.getElementById('loginMsg').textContent = '';
}

function showRegister() {
    document.getElementById('pelangganLogin').classList.add('hidden');
    document.getElementById('registerForm').classList.remove('hidden');
}

function showLogin() {
    document.getElementById('pelangganLogin').classList.remove('hidden');
    document.getElementById('registerForm').classList.add('hidden');
}

// Login Admin
function loginAdmin() {
    const user = document.getElementById('adminUsername').value;
    const pass = document.getElementById('adminPassword').value;
    
    if (user === 'admin' && pass === 'admin123') {
        currentRole = 'admin';
        document.getElementById('login').classList.add('hidden');
        document.getElementById('adminDashboard').classList.remove('hidden');
        initData();
        loadAllData();
        updateDashboard();
    } else {
        document.getElementById('loginMsg').textContent = 'Username atau password salah!';
    }
}

// Register Pelanggan
function registerPelanggan() {
    const nama = document.getElementById('regNama').value;
    const telp = document.getElementById('regTelp').value;
    const email = document.getElementById('regEmail').value;
    const alamat = document.getElementById('regAlamat').value;
    
    if (nama && telp && email && alamat) {
        // Cek apakah nomor sudah terdaftar
        if (pelanggan.find(p => p.telp === telp)) {
            document.getElementById('loginMsg').textContent = 'Nomor telepon sudah terdaftar!';
            return;
        }
        
        pelanggan.push({
            id: 'PLG' + Date.now(),
            nama,
            telp,
            email,
            alamat,
            tglDaftar: new Date().toLocaleDateString('id-ID')
        });
        
        document.getElementById('loginMsg').textContent = '';
        alert('Registrasi berhasil! Silakan login dengan nomor telepon Anda.');
        showLogin();
        
        // Clear form
        document.getElementById('regNama').value = '';
        document.getElementById('regTelp').value = '';
        document.getElementById('regEmail').value = '';
        document.getElementById('regAlamat').value = '';
    } else {
        document.getElementById('loginMsg').textContent = 'Semua field harus diisi!';
    }
}

// Login Pelanggan
function loginPelanggan() {
    const telp = document.getElementById('pelangganTelp').value;
    
    const user = pelanggan.find(p => p.telp === telp);
    
    if (user) {
        currentUser = user;
        currentRole = 'pelanggan';
        document.getElementById('login').classList.add('hidden');
        document.getElementById('pelangganDashboard').classList.remove('hidden');
        
        // Load user info
        document.getElementById('userNama').textContent = user.nama;
        document.getElementById('userTelp').textContent = user.telp;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userAlamat').textContent = user.alamat;
        
        initData();
        loadPesananPelanggan();
    } else {
        document.getElementById('loginMsg').textContent = 'Nomor telepon tidak terdaftar!';
    }
}

function logout() {
    currentUser = null;
    document.getElementById('adminDashboard').classList.add('hidden');
    document.getElementById('pelangganDashboard').classList.add('hidden');
    document.getElementById('login').classList.remove('hidden');
    hideAllSections();
    
    // Reset form
    document.getElementById('adminUsername').value = '';
    document.getElementById('adminPassword').value = '';
    document.getElementById('pelangganTelp').value = '';
    document.getElementById('loginMsg').textContent = '';
}

function showSection(section) {
    hideAllSections();
    document.getElementById(section).classList.remove('hidden');
    
    if (section === 'transaksi') {
        updatePilihLayanan();
    }
    if (section === 'adminDashboard') {
        updateDashboard();
    }
    if (section === 'laporan') {
        loadLaporan();
    }
    if (section === 'pelanggan') {
        loadPelanggan();
    }
    if (section === 'layanan') {
        loadLayanan();
    }
    if (section === 'pesananSaya') {
        loadPesananPelanggan();
    }
    if (section === 'buatPesanan') {
        updateLayananPelanggan();
    }
    if (section === 'riwayat') {
        loadRiwayatPelanggan();
    }
}

function hideAllSections() {
    const sections = ['pelanggan', 'layanan', 'transaksi', 'laporan', 
                     'pesananSaya', 'buatPesanan', 'riwayat'];
    sections.forEach(s => document.getElementById(s).classList.add('hidden'));
}

function loadAllData() {
    loadPelanggan();
    loadLayanan();
    loadLaporan();
}

// === PELANGGAN (ADMIN VIEW) ===
function loadPelanggan() {
    const tabel = document.getElementById('tabelPelanggan');
    tabel.innerHTML = '<tr><th>ID</th><th>Nama</th><th>Telepon</th><th>Email</th><th>Alamat</th><th>Aksi</th></tr>';
    
    pelanggan.forEach((p, i) => {
        tabel.innerHTML += `
            <tr>
                <td>${p.id}</td>
                <td>${p.nama}</td>
                <td>${p.telp}</td>
                <td>${p.email}</td>
                <td>${p.alamat}</td>
                <td><button class="danger" onclick="hapusPelanggan(${i})">Hapus</button></td>
            </tr>`;
    });
}

function hapusPelanggan(index) {
    if (confirm('Yakin ingin menghapus pelanggan ini?')) {
        pelanggan.splice(index, 1);
        loadPelanggan();
        updateDashboard();
    }
}

// === LAYANAN ===
function simpanLayanan() {
    const nama = document.getElementById('namaLayanan').value;
    const harga = document.getElementById('hargaLayanan').value;
    const estimasi = document.getElementById('estimasiLayanan').value;
    
    if (nama && harga && estimasi) {
        if (editingLayananIndex >= 0) {
            // Mode Edit
            layanan[editingLayananIndex] = {
                nama, 
                harga: parseFloat(harga), 
                estimasi: parseInt(estimasi)
            };
            alert('Layanan berhasil diupdate!');
            editingLayananIndex = -1;
            document.getElementById('btnSimpanLayanan').textContent = 'Tambah Layanan';
            document.getElementById('btnBatalLayanan').classList.add('hidden');
        } else {
            // Mode Tambah
            layanan.push({ 
                nama, 
                harga: parseFloat(harga), 
                estimasi: parseInt(estimasi) 
            });
            alert('Layanan berhasil ditambahkan!');
        }
        
        document.getElementById('namaLayanan').value = '';
        document.getElementById('hargaLayanan').value = '';
        document.getElementById('estimasiLayanan').value = '';
        
        loadLayanan();
    } else {
        alert('Semua field harus diisi!');
    }
}

function tambahLayanan() {
    simpanLayanan();
}

function editLayanan(index) {
    editingLayananIndex = index;
    const l = layanan[index];
    
    document.getElementById('namaLayanan').value = l.nama;
    document.getElementById('hargaLayanan').value = l.harga;
    document.getElementById('estimasiLayanan').value = l.estimasi;
    
    document.getElementById('btnSimpanLayanan').textContent = 'Update Layanan';
    document.getElementById('btnBatalLayanan').classList.remove('hidden');
    
    // Scroll ke form
    document.getElementById('namaLayanan').scrollIntoView({ behavior: 'smooth', block: 'center' });
    document.getElementById('namaLayanan').focus();
}

function batalEditLayanan() {
    editingLayananIndex = -1;
    document.getElementById('namaLayanan').value = '';
    document.getElementById('hargaLayanan').value = '';
    document.getElementById('estimasiLayanan').value = '';
    document.getElementById('btnSimpanLayanan').textContent = 'Tambah Layanan';
    document.getElementById('btnBatalLayanan').classList.add('hidden');
}

function loadLayanan() {
    const tabel = document.getElementById('tabelLayanan');
    tabel.innerHTML = '<tr><th>Nama Layanan</th><th>Harga/Kg</th><th>Estimasi</th><th>Aksi</th></tr>';
    
    layanan.forEach((l, i) => {
        tabel.innerHTML += `
            <tr>
                <td>${l.nama}</td>
                <td>Rp ${l.harga.toLocaleString()}</td>
                <td>${l.estimasi} hari</td>
                <td>
                    <button class="success" onclick="editLayanan(${i})">‚úèÔ∏è Edit</button>
                    <button class="danger" onclick="hapusLayanan(${i})">üóëÔ∏è Hapus</button>
                </td>
            </tr>`;
    });
}

function hapusLayanan(index) {
    if (confirm('Yakin ingin menghapus layanan ini?')) {
        layanan.splice(index, 1);
        loadLayanan();
        // Reset form jika sedang edit layanan yang dihapus
        if (editingLayananIndex === index) {
            batalEditLayanan();
        }
    }
}

// === TRANSAKSI ADMIN ===
function updatePilihPelanggan() {
    const select = document.getElementById('pilihPelanggan');
    select.innerHTML = '<option value="">-- Pilih Pelanggan --</option>';
    pelanggan.forEach((p, i) => {
        select.innerHTML += `<option value="${i}">${p.nama} (${p.telp})</option>`;
    });
}

function updatePilihLayanan() {
    const select = document.getElementById('pilihLayanan');
    select.innerHTML = '<option value="">-- Pilih Layanan --</option>';
    layanan.forEach((l, i) => {
        select.innerHTML += `<option value="${i}">${l.nama} - Rp${l.harga.toLocaleString()}/kg</option>`;
    });
}

function hitungTotal() {
    const pelangganIdx = document.getElementById('pilihPelanggan').value;
    const layananIdx = document.getElementById('pilihLayanan').value;
    const berat = parseFloat(document.getElementById('beratLaundry').value);
    
    if (pelangganIdx !== '' && layananIdx !== '' && berat) {
        const total = layanan[layananIdx].harga * berat;
        document.getElementById('totalBayar').textContent = `Rp ${total.toLocaleString()}`;
    }
}

function simpanTransaksi() {
    const pelangganIdx = document.getElementById('pilihPelanggan').value;
    const layananIdx = document.getElementById('pilihLayanan').value;
    const berat = parseFloat(document.getElementById('beratLaundry').value);
    const catatan = document.getElementById('catatanTransaksi').value;
    
    if (pelangganIdx !== '' && layananIdx !== '' && berat) {
        const total = layanan[layananIdx].harga * berat;
        const orderNo = 'ORD' + Date.now();
        const tanggalSelesai = new Date();
        tanggalSelesai.setDate(tanggalSelesai.getDate() + layanan[layananIdx].estimasi);
        
        transaksi.push({
            orderNo,
            tanggal: new Date().toLocaleDateString('id-ID'),
            tanggalSelesai: tanggalSelesai.toLocaleDateString('id-ID'),
            pelangganNama: pelanggan[pelangganIdx].nama,
            pelangganTelp: pelanggan[pelangganIdx].telp,
            layanan: layanan[layananIdx].nama,
            berat,
            total,
            status: 'pending',
            catatan: catatan || '-'
        });
        
        document.getElementById('pilihPelanggan').value = '';
        document.getElementById('pilihLayanan').value = '';
        document.getElementById('beratLaundry').value = '';
        document.getElementById('catatanTransaksi').value = '';
        document.getElementById('totalBayar').textContent = 'Rp 0';
        
        alert('Transaksi berhasil disimpan! No. Order: ' + orderNo);
        updateDashboard();
    }
}

// === LAPORAN ADMIN ===
function loadLaporan() {
    const tabel = document.getElementById('tabelLaporan');
    tabel.innerHTML = `
        <tr>
            <th>No. Order</th>
            <th>Tanggal</th>
            <th>Pelanggan</th>
            <th>Layanan</th>
            <th>Berat</th>
            <th>Total</th>
            <th>Status</th>
            <th>Aksi</th>
        </tr>`;
    
    let filteredTransaksi = transaksi;
    if (currentFilter !== 'semua') {
        filteredTransaksi = transaksi.filter(t => t.status === currentFilter);
    }
    
    filteredTransaksi.forEach((t, i) => {
        let badgeClass = '';
        switch(t.status) {
            case 'pending': badgeClass = 'badge-pending'; break;
            case 'proses': badgeClass = 'badge-process'; break;
            case 'selesai': badgeClass = 'badge-done'; break;
            case 'diambil': badgeClass = 'badge-taken'; break;
        }
        
        const realIndex = transaksi.indexOf(t);
        
        tabel.innerHTML += `
            <tr>
                <td>${t.orderNo}</td>
                <td>${t.tanggal}</td>
                <td>${t.pelangganNama}<br><small>${t.pelangganTelp}</small></td>
                <td>${t.layanan}</td>
                <td>${t.berat} kg</td>
                <td>Rp ${t.total.toLocaleString()}</td>
                <td>
                    <span class="badge ${badgeClass}">${t.status.toUpperCase()}</span><br>
                    <small style="color: #666;">${t.metodePembayaran || 'Tunai'}</small>
                    ${t.buktiTransfer ? '<br><button class="secondary" style="margin-top: 5px; padding: 5px 10px; font-size: 11px;" onclick="lihatBuktiTransfer(' + realIndex + ')">üìÑ Lihat Bukti</button>' : ''}
                </td>
                <td>
                    <select onchange="updateStatus(${realIndex}, this.value)">
                        <option value="">-- Ubah Status --</option>
                        <option value="pending">Pending</option>
                        <option value="proses">Proses</option>
                        <option value="selesai">Selesai</option>
                        <option value="diambil">Diambil</option>
                    </select>
                </td>
            </tr>`;
    });
}

function updateStatus(index, newStatus) {
    if (newStatus) {
        transaksi[index].status = newStatus;
        loadLaporan();
        updateDashboard();
    }
}

function filterStatus(status) {
    currentFilter = status;
    loadLaporan();
}

function lihatBuktiTransfer(index) {
    const t = transaksi[index];
    if (t.buktiTransfer) {
        // Buat window baru untuk menampilkan bukti transfer
        const newWindow = window.open('', '_blank', 'width=800,height=600');
        newWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Bukti Transfer - ${t.orderNo}</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                        background: #f5f5f5;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    }
                    .info {
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        margin-bottom: 20px;
                        width: 100%;
                        max-width: 600px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    }
                    .info h2 {
                        color: #667eea;
                        margin-bottom: 15px;
                    }
                    .info p {
                        margin: 8px 0;
                    }
                    img {
                        max-width: 100%;
                        height: auto;
                        border-radius: 10px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }
                    .btn {
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        margin-top: 20px;
                    }
                </style>
            </head>
            <body>
                <div class="info">
                    <h2>Bukti Transfer</h2>
                    <p><strong>No. Order:</strong> ${t.orderNo}</p>
                    <p><strong>Pelanggan:</strong> ${t.pelangganNama}</p>
                    <p><strong>Total:</strong> Rp ${t.total.toLocaleString()}</p>
                    <p><strong>Metode:</strong> ${t.metodePembayaran}</p>
                    <p><strong>File:</strong> ${t.namaFileBukti}</p>
                </div>
                <img src="${t.buktiTransfer}" alt="Bukti Transfer">
                <button class="btn" onclick="window.close()">Tutup</button>
            </body>
            </html>
        `);
    }
}

function updateDashboard() {
    document.getElementById('totalTransaksi').textContent = transaksi.length;
    document.getElementById('totalPelanggan').textContent = pelanggan.length;
    
    const pending = transaksi.filter(t => t.status === 'pending').length;
    document.getElementById('totalPending').textContent = pending;
    
    const today = new Date().toLocaleDateString('id-ID');
    const pendapatanHariIni = transaksi
        .filter(t => t.tanggal === today)
        .reduce((sum, t) => sum + t.total, 0);
    document.getElementById('pendapatanHariIni').textContent = 'Rp ' + pendapatanHariIni.toLocaleString();
}

// === PELANGGAN FEATURES ===
function updateLayananPelanggan() {
    const select = document.getElementById('pelangganPilihLayanan');
    select.innerHTML = '<option value="">-- Pilih Layanan --</option>';
    layanan.forEach((l, i) => {
        select.innerHTML += `<option value="${i}">${l.nama} - Rp${l.harga.toLocaleString()}/kg (${l.estimasi} hari)</option>`;
    });
}

function hitungTotalPelanggan() {
    const layananIdx = document.getElementById('pelangganPilihLayanan').value;
    const berat = parseFloat(document.getElementById('pelangganBerat').value);
    
    if (layananIdx !== '' && berat) {
        const total = layanan[layananIdx].harga * berat;
        document.getElementById('totalBayarPelanggan').textContent = `Rp ${total.toLocaleString()}`;
    }
}

function buatPesananBaru() {
    const layananIdx = document.getElementById('pelangganPilihLayanan').value;
    const berat = parseFloat(document.getElementById('pelangganBerat').value);
    const catatan = document.getElementById('pelangganCatatan').value;
    const buktiFile = document.getElementById('buktiTransfer').files[0];
    
    if (layananIdx === '' || !berat) {
        alert('Mohon lengkapi layanan dan berat!');
        return;
    }
    
    if (!buktiFile) {
        alert('Mohon upload bukti transfer!');
        return;
    }
    
    // Validasi ukuran file (max 5MB)
    if (buktiFile.size > 5 * 1024 * 1024) {
        alert('Ukuran file terlalu besar! Maksimal 5MB');
        return;
    }
    
    // Baca file sebagai base64
    const reader = new FileReader();
    reader.onload = function(e) {
        const total = layanan[layananIdx].harga * berat;
        const orderNo = 'ORD' + Date.now();
        const tanggalSelesai = new Date();
        tanggalSelesai.setDate(tanggalSelesai.getDate() + layanan[layananIdx].estimasi);
        
        transaksi.push({
            orderNo,
            tanggal: new Date().toLocaleDateString('id-ID'),
            tanggalSelesai: tanggalSelesai.toLocaleDateString('id-ID'),
            pelangganNama: currentUser.nama,
            pelangganTelp: currentUser.telp,
            layanan: layanan[layananIdx].nama,
            berat,
            total,
            status: 'pending',
            catatan: catatan || '-',
            metodePembayaran: 'Transfer',
            buktiTransfer: e.target.result,
            namaFileBukti: buktiFile.name
        });
        
        document.getElementById('pelangganPilihLayanan').value = '';
        document.getElementById('pelangganBerat').value = '';
        document.getElementById('pelangganCatatan').value = '';
        document.getElementById('buktiTransfer').value = '';
        document.getElementById('totalBayarPelanggan').textContent = 'Rp 0';
        
        alert('Pesanan berhasil dibuat!\n\nNo. Order: ' + orderNo + '\n\nBukti transfer sudah diterima. Mohon antar laundry Anda ke toko kami dengan membawa nomor order ini.\n\nPembayaran akan diverifikasi oleh admin.');
        showSection('pelangganDashboard');
    };
    reader.readAsDataURL(buktiFile);
}

function loadPesananPelanggan() {
    const container = document.getElementById('listPesananAktif');
    const pesanan = transaksi.filter(t => 
        t.pelangganTelp === currentUser.telp && 
        (t.status === 'pending' || t.status === 'proses' || t.status === 'selesai')
    );
    
    if (pesanan.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">Belum ada pesanan aktif</p>';
        return;
    }
    
    container.innerHTML = '';
    pesanan.forEach(p => {
        let badgeClass = '';
        let statusText = '';
        switch(p.status) {
            case 'pending': 
                badgeClass = 'badge-pending'; 
                statusText = 'Menunggu diproses';
                break;
            case 'proses': 
                badgeClass = 'badge-process'; 
                statusText = 'Sedang dikerjakan';
                break;
            case 'selesai': 
                badgeClass = 'badge-done'; 
                statusText = 'Siap diambil';
                break;
        }
        
        container.innerHTML += `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 5px;">${p.orderNo}</h3>
                        <span class="badge ${badgeClass}">${statusText}</span>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 24px; font-weight: bold; color: #333;">Rp ${p.total.toLocaleString()}</p>
                    </div>
                </div>
                <div class="order-details">
                    <div class="order-detail-item">
                        <strong>Tanggal Order</strong>
                        ${p.tanggal}
                    </div>
                    <div class="order-detail-item">
                        <strong>Layanan</strong>
                        ${p.layanan}
                    </div>
                    <div class="order-detail-item">
                        <strong>Berat</strong>
                        ${p.berat} kg
                    </div>
                    <div class="order-detail-item">
                        <strong>Est. Selesai</strong>
                        ${p.tanggalSelesai}
                    </div>
                    ${p.catatan !== '-' ? `
                    <div class="order-detail-item" style="grid-column: 1 / -1;">
                        <strong>Catatan</strong>
                        ${p.catatan}
                    </div>` : ''}
                    ${p.metodePembayaran ? `
                    <div class="order-detail-item" style="grid-column: 1 / -1;">
                        <strong>Metode Pembayaran</strong>
                        ${p.metodePembayaran}
                        ${p.buktiTransfer ? ' <span style="color: #28a745;">‚úì Bukti sudah diupload</span>' : ''}
                    </div>` : ''}
                </div>
            </div>
        `;
    });
}

function loadRiwayatPelanggan() {
    const container = document.getElementById('listRiwayat');
    const riwayat = transaksi.filter(t => 
        t.pelangganTelp === currentUser.telp && t.status === 'diambil'
    );
    
    if (riwayat.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">Belum ada riwayat pesanan</p>';
        return;
    }
    
    container.innerHTML = '';
    riwayat.forEach(p => {
        container.innerHTML += `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 5px;">${p.orderNo}</h3>
                        <span class="badge badge-taken">SELESAI</span>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 24px; font-weight: bold; color: #333;">Rp ${p.total.toLocaleString()}</p>
                    </div>
                </div>
                <div class="order-details">
                    <div class="order-detail-item">
                        <strong>Tanggal Order</strong>
                        ${p.tanggal}
                    </div>
                    <div class="order-detail-item">
                        <strong>Layanan</strong>
                        ${p.layanan}
                    </div>
                    <div class="order-detail-item">
                        <strong>Berat</strong>
                        ${p.berat} kg
                    </div>
                    <div class="order-detail-item">
                        <strong>Tanggal Selesai</strong>
                        ${p.tanggalSelesai}
                    </div>
                </div>
            </div>
        `;
    });
}

// Initialize
initData();
</script>
</body>
</html>
